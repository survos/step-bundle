{# file: templates/step/slides.html.twig — Stimulus + slides[] #}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ code|default('Steps') }} — Slides</title>

  {# Your bundle CSS (kept) #}
  <link rel="stylesheet" href="{{ asset('bundles/survosstep/steps.css') }}">
  {# Reveal CSS will be imported by the Stimulus controller via AssetMapper #}
</head>
<body>

<div
  class="reveal"
  {{ stimulus_controller('reveal', {
      code: code,
      slides: slides,
      jsonUrl: json_url,
      theme: 'black'
  }) }}
>
  <div class="slides">
    {# iterate slides (already flattened server-side) #}
    {% for slide in slides %}
      {{ dump(slide) }}
      {% set slideTitle = slide.title|default('Step') %}
      {% set taskName   = slide.task_name|default(code) %}
      {# provide context for DisplayCode('artifact:…') resolver #}
      {% set __task_name  = taskName %}
      {% set __step_title = slideTitle %}

      <section data-task-name="{{ taskName|e('html_attr') }}">
        <div class="slide-shell">
          <header class="slide-header">
            <h2 class="slide-title">{{ slideTitle }}</h2>
          </header>

          <div class="slide-content">
            {% if slide.description %}<p class="slide-description">{{ slide.description }}</p>{% endif %}
            {% if slide.bullets %}<ul>{% for b in slide.bullets %}<li>{{ b }}</li>{% endfor %}</ul>{% endif %}

            {% if slide.actions %}
              {% for a in slide.actions %}
                <div class="action action-{{ (a.lang ?? a.language ?? a.type ?? 'text')|lower }}">
                  {{ render_action(_context, a)|raw }}
                </div>
              {% endfor %}
            {% endif %}
          </div>

          <footer class="slide-footer"></footer>
        </div>
      </section>
    {% endfor %}
  </div>
</div>

{# HUD (controlled by Stimulus) #}
{% set _sc = '@SurvosStep/reveal' %}
<div class="slide-hud" data-controller="reveal"
     {{ stimulus_controller(_sc, { code: code, slides: slides, jsonUrl: json_url }) }}>
  {% if app is defined %}
    <a href="{{ path('app_home') }}" class="hud-link">Home</a>
  {% else %}
    <span class="hud-link">Home</span>
  {% endif %}
  <span class="hud-sep">|</span>
  <a {{ stimulus_target('reveal', 'jsonDeckLink') }} href="#" target="_blank" class="hud-link">JSON (deck)</a>
  <span class="hud-sep">|</span>
  <a {{ stimulus_target('reveal', 'jsonSlideLink') }} href="#" target="_blank" class="hud-link" style="display:none">JSON (slide)</a>
  <span class="hud-sep">|</span>
  <span {{ stimulus_target('reveal', 'codeLabel') }} class="hud-label">{{ code }}</span>
  <span class="hud-sep">*</span>
  <span {{ stimulus_target('reveal', 'stepLabel') }} class="hud-label">intro</span>
  <span class="hud-sep">|</span>
  <button type="button"
          {{ stimulus_target('reveal', 'copyButton') }}
          {{ stimulus_action('reveal', 'copy') }}
          class="hud-copy" title="Copy run command">
    Copy run
  </button>
</div>

</body>
</html>
