{# file: templates/step/debug.html.twig — clear debug view with per-slide artifacts listed and inlined #}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>[DEBUG] {{ code }} — Slides</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="{{ asset('bundles/survosstep/steps.css') }}" rel="stylesheet" />
  <style>
    :root{--bg:#0f1320;--panel:#171b2b;--muted:#8aa0b4;--text:#e7eef7;--accent:#74c0fc;--ok:#51cf66}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Roboto,Arial}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#24304b;color:var(--muted);font-size:12px}
    .panel{background:#0b0e18;border:1px solid #1f2540;border-radius:8px;margin:12px 0}
    .panel>header{padding:8px 10px;border-bottom:1px solid #1f2540;color:var(--muted);font-size:12px}
    .panel .content{padding:10px;overflow:auto}
    .slide{background:var(--panel);border-radius:10px;margin:18px 0;border:1px solid #1f2540}
    .slide header{padding:12px 14px;border-bottom:1px solid #1f2540;display:flex;justify-content:space-between}
    .slide .body{padding:14px}
    .cols{display:grid;grid-template-columns:1.2fr 1fr;gap:12px}
    .pill{padding:2px 8px;border:1px solid #30405e;border-radius:999px;color:var(--muted);font-size:12px;display:inline-block;margin-left:.5rem}
    pre{white-space:pre-wrap;background:#0b0e18;border-radius:6px;padding:10px;overflow:auto}
    details>summary{cursor:pointer}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1>[DEBUG] Slides for <span class="badge">{{ code }}</span></h1>
    <div>
      <a href="{{ json_url }}" target="_blank" class="badge">Deck JSON</a>
      <a href="{{ path('survos_step_slides', {code: code}) }}" target="_blank" class="badge">
        <span class="badge">{{ slides|length }} slides</span>
      </a>
    </div>
  </div>

  {% for slide in slides %}
    {# now we can use the DTOs, which are the metadata #}
    {% set step = slide.step %}
    {% set task = slide.task %}

    {% set slideTitle = slide.title|default('Step') %}
    {% set taskName   = slide.task_name|default(code) %}
    {# Provide context for artifact resolver used by render_action() #}
    {% set __task_name  = taskName %}
    {% set __step_title = slideTitle %}

    <section class="slide" id="slide-{{ loop.index }}">
      <header>
        <h2>{{ loop.index }}. {{ slideTitle }}</h2>
        <div>
          <span class="pill">{{ taskName }}</span>
          <span class="pill">{{ step.actions|length }} actions</span>
          <span class="pill">{{ slide.artifacts|length }} files</span>
        </div>
      </header>

      <div class="body">
        {% if slide.description %}
          <div class="panel"><header>Description</header><div class="content">{{ slide.description }}</div></div>
        {% endif %}
        {% if slide.bullets %}
          <div class="panel"><header>Bullets</header>
            <div class="content"><ul>{% for b in slide.bullets %}<li>{{ b }}</li>{% endfor %}</ul></div>
          </div>
        {% endif %}

        <div class="cols">
          <div class="panel">
            <header>Rendered Actions</header>
            <div class="content">
                php?
              <pre><code class="language-php">
function hello() {
    echo "Hello World!";
}
</code></pre>

              <pre><code class="language-javascript">
const greeting = "Hello World!";
console.log(greeting);
</code></pre>
              {% if step.actions %}
                {% for a in step.actions %}

                  <div class="action action-{{ (a.lang ?? a.language ?? a.type ?? 'text')|lower }}" style="margin-bottom:10px">
{#                    {{ dump(_context, a) }}#}
                    <code>{{ a|short_class }}</code>
                      {{ dump(a) }}
{#                    {{ render_action(a, renderer)|raw }}#}
                  </div>
                {% endfor %}
              {% else %}
                <em>No step actions.</em>
              {% endif %}
            </div>
          </div>

          <div class="panel">
            <header>Step JSON</header>
            <div class="content">
              <pre><code>{{ slide.sparseStep|json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_SLASHES')) }}</code></pre>
            </div>
          </div>
        </div>

        <div class="panel">
          <header>Artifacts on Disk ({{ slide.artifacts|length }})</header>
          <div class="content">
            {% if slide.artifacts|length == 0 %}
              <em>No artifacts for this slide.</em>
            {% else %}
              {% for f in slide.artifacts %}
                <details>
                  <summary>
                    <a href="{{ f.path }}" target="_blank" rel="noopener">{{ f.name }}</a>
                    <span class="pill">{{ (f.size/1024)|number_format(1) }} KB</span>
                    <span class="pill">{{ f.mtime|date('H:i:s') }}</span>
                  </summary>
                  {% if f.contents is not null %}
                    <pre><code class="language-text">{{ f.contents }}</code></pre>
                  {% endif %}
                </details>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </section>
  {% endfor %}
</div>
</body>
</html>
