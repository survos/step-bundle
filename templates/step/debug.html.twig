{# file: templates/step/debug.html.twig — minimal debug view for slides & artifacts #}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>[DEBUG] {{ code }} — Slides</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #0f1320;
      --panel: #171b2b;
      --muted: #8aa0b4;
      --text: #e7eef7;
      --accent: #74c0fc;
      --ok: #51cf66;
    }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 1200px; margin: 24px auto; padding: 0 16px; }

    .header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    .header h1 { font-size: 20px; margin: 0; }
    .badge { display:inline-block; padding:2px 8px; border-radius: 999px; background: #24304b; color: var(--muted); font-size: 12px; }
    .json-links { display:flex; gap:10px; align-items:center; }

    .deck { background: var(--panel); border-radius: 10px; padding: 12px; margin-bottom: 18px; }
    .deck pre { margin:0; overflow:auto; background: #0b0e18; padding: 10px; border-radius: 8px; }

    .slide { background: var(--panel); border-radius: 10px; margin: 18px 0; overflow: hidden; border: 1px solid #1f2540; }
    .slide header { padding: 12px 14px; border-bottom: 1px solid #1f2540; display:flex; align-items:baseline; justify-content:space-between; gap: 12px; }
    .slide header h2 { margin:0; font-size: 18px; }
    .slide .meta { font-size: 12px; color: var(--muted); }
    .slide .body { padding: 14px; display: grid; gap: 12px; }
    .slide .cols { display:grid; grid-template-columns: 1.2fr 1fr; gap: 12px; }
    .panel { background:#0b0e18; border: 1px solid #1f2540; border-radius: 8px; }
    .panel header { font-size: 12px; color: var(--muted); padding: 8px 10px; border-bottom: 1px solid #1f2540; }
    .panel .content { padding: 10px; overflow:auto; }
    .kvs { display:grid; grid-template-columns: 160px 1fr; gap: 8px 10px; }
    .pill { padding:2px 8px; border:1px solid #30405e; border-radius:999px; color: var(--muted); display:inline-block; font-size:12px; }
    .actions .action { margin-bottom: 10px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .ok { color: var(--ok); }
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1>[DEBUG] Slides for <span class="badge">{{ code }}</span></h1>
    <div class="json-links">
      <a href="{{ json_url }}" target="_blank" rel="noopener">Deck JSON</a>
      <span class="badge">{{ slides|length }} slides</span>
    </div>
  </div>

  <div class="deck">
    <strong>Deck summary</strong>
    <pre><code>{{ {
      code: code,
      slides: slides|length
    }|json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_SLASHES')) }}</code></pre>
  </div>

  {# slides list #}
  {% for slide in slides %}
    {% set slideTitle = slide.title|default('Step') %}
    {% set taskName   = slide.task_name|default(code) %}
    {# Provide context for artifact resolver used by render_action() #}
    {% set __task_name  = taskName %}
    {% set __step_title = slideTitle %}

    <section class="slide" id="slide-{{ loop.index }}">
      <header>
        <h2>{{ loop.index }}. {{ slideTitle }}</h2>
        <div class="meta">
          task: <span class="pill">{{ taskName }}</span>
          · actions: <span class="pill">{{ slide.actions|length }}</span>
        </div>
      </header>

      <div class="body">
        {% if slide.description %}
          <div class="panel">
            <header>Description</header>
            <div class="content">{{ slide.description }}</div>
          </div>
        {% endif %}

        {% if slide.bullets %}
          <div class="panel">
            <header>Bullets</header>
            <div class="content">
              <ul>
                {% for b in slide.bullets %}<li>{{ b }}</li>{% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}

        <div class="cols">
          <div class="panel actions">
            <header>Rendered Actions</header>
            <div class="content">
              {% if slide.actions %}
                {% for a in slide.actions %}
                  <div class="action action-{{ (a.lang ?? a.language ?? a.type ?? 'text')|lower }}">
                    {{ render_action(_context, a)|raw }}
                  </div>
                {% endfor %}
              {% else %}
                <em>No actions.</em>
              {% endif %}
            </div>
          </div>
          {{ dump(slide.artifacts) }}

{#          {% if slide.artifacts|length %}#}
            <div class="panel">
              <header>Artifacts on Disk</header>
              <div class="content">
                <ul>
                  {% for f in slide.artifacts %}
                    <li>
                      <code>{{ f.name }}</code>
                      <span class="pill">{{ (f.size/1024)|number_format(1) }} KB</span>
                      <span class="pill">{{ f.mtime|date('H:i:s') }}</span>
                      <pre>{{ f.contents }}</pre>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>



          <div class="panel">
            <header>Slide JSON</header>
            <div class="content">
              <pre><code>{{ slide|json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_SLASHES')) }}</code></pre>
            </div>

              <header>Artifacts on Disk ({{ slide.artifacts|length }})</header>
              <div class="content">
                {% if slide.artifacts|length == 0 %}
                  <em>No artifacts for this slide.</em>
                {% else %}
                  {% for f in slide.artifacts %}
                    <details style="margin-bottom:0.5rem;">
                      <summary>
                        <a href="{{ f.path }}" target="_blank" rel="noopener">{{ f.name }}</a>
                        <span class="pill">{{ (f.size/1024)|number_format(1) }} KB</span>
                      </summary>
                      <pre><code class="language-text">{{ f.contents|default('') }}</code></pre>
                    </details>
                  {% endfor %}
                {% endif %}
              </div>


          </div>
        </div>

      </div>
    </section>
  {% endfor %}
</div>
</body>
</html>
